% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/cytetype.R
\name{PrepareCyteTypeR}
\alias{PrepareCyteTypeR}
\title{Prepare Seurat Object for CyteType Analysis}
\usage{
PrepareCyteTypeR(
  obj,
  marker_table,
  group_key = "seurat_clusters",
  gene_symbols = "gene_symbols",
  n_top_genes = 50,
  aggregate_metadata = TRUE,
  min_percentage = 10,
  pcent_batch_size = 2000,
  coordinates_key = "umap",
  max_cells_per_group = 1000
)
}
\arguments{
\item{obj}{A Seurat object with normalized data and clustering results.}

\item{marker_table}{Data frame containing marker genes with columns:
'cluster', 'gene', and 'avg_log2FC'. Output from Seurat's
\code{FindAllMarkers()} function.}

\item{group_key}{Character string specifying the metadata column containing
cluster assignments. Default is "seurat_clusters".}

\item{gene_symbols}{Character string specifying the gene symbol field name. Default is 'gene_symbols'.}

\item{n_top_genes}{Integer specifying the maximum number of top marker genes
per cluster to include (filtered by avg_log2FC > 1). Default is 50.}

\item{aggregate_metadata}{Logical indicating whether to aggregate metadata
across cells within each cluster. Default is \code{TRUE}.}

\item{min_percentage}{Numeric threshold for minimum percentage (currently unused).
Default is 10.}

\item{pcent_batch_size}{Integer specifying batch size for expression percentage
calculations. Default is 2000.}

\item{coordinates_key}{Character string specifying which dimensional reduction
to use for visualization coordinates (e.g., "umap", "tsne"). Default is "umap".}

\item{max_cells_per_group}{Integer specifying maximum cells per cluster for
subsampling (currently unused). Default is 1000.}
}
\value{
Named list containing formatted data for CyteType analysis:
\itemize{
\item \code{clusterLabels}: List mapping numeric cluster IDs to original labels
\item \code{clusterMetadata}: Aggregated metadata by cluster (if enabled)
\item \code{markerGenes}: List of top marker genes per cluster
\item \code{visualizationData}: Coordinates and cluster assignments for plotting
\item \code{expressionData}: Expression percentages by cluster
}
}
\description{
Prepares a Seurat object and a gene marker table for CyteType API by extracting and formatting
cluster labels, metadata, marker genes, visualization coordinates, and
expression data into the required data structure.
}
\details{
The function performs the following steps:
\enumerate{
\item Validates the Seurat object structure
\item Creates a mapping from original cluster labels to sequential numeric IDs
\item Aggregates metadata across cells within clusters (optional)
\item Filters and selects top marker genes per cluster
\item Extracts dimensional reduction coordinates for visualization
\item Calculates expression percentages across clusters
}

Clusters are renumbered sequentially (1, 2, 3, ...) to ensure consistent
formatting regardless of original cluster naming.
}
\examples{
\dontrun{
# Prepare Seurat object with UMAP coordinates
prepped_data <- PrepareCyteTypeR(
  obj = seurat_obj,
  marker_table = markers_df,
  group_key = "seurat_clusters",
  n_top_genes = 30,
  coordinates_key = "umap"
)
}

}
